// frontend/src/services/api.js

import axios from 'axios';

// URL backendu - zmień port jeśli Twój backend działa na innym
const API_URL = 'http://localhost:8000/api';

// Konfiguracja axios
const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Funkcje API dla parkingów
export const parkingAPI = {
  // Pobierz wszystkie parkingi
  getAllParkings: async () => {
    try {
      const response = await api.get('/parkings');
      return response.data;
    } catch (error) {
      console.error('Błąd przy pobieraniu parkingów:', error);
      throw error;
    }
  },

  // Pobierz parking po ID
  getParkingById: async (id) => {
    try {
      const response = await api.get(`/parkings/${id}`);
      return response.data;
    } catch (error) {
      console.error(`Błąd przy pobieraniu parkingu ${id}:`, error);
      throw error;
    }
  },

  // Dodaj nowy parking
  createParking: async (parkingData) => {
    try {
      const response = await api.post('/parkings', parkingData);
      return response.data;
    } catch (error) {
      console.error('Błąd przy tworzeniu parkingu:', error);
      throw error;
    }
  },

  // Aktualizuj parking
  updateParking: async (id, parkingData) => {
    try {
      const response = await api.put(`/parkings/${id}`, parkingData);
      return response.data;
    } catch (error) {
      console.error(`Błąd przy aktualizacji parkingu ${id}:`, error);
      throw error;
    }
  },

  // Usuń parking
  deleteParking: async (id) => {
    try {
      const response = await api.delete(`/parkings/${id}`);
      return response.data;
    } catch (error) {
      console.error(`Błąd przy usuwaniu parkingu ${id}:`, error);
      throw error;
    }
  }
};

// Funkcje API dla rezerwacji
// Funkcje API dla rezerwacji
export const reservationAPI = {
  createReservation: async (reservationData) => {
    try {
      const response = await api.post('/reservations', reservationData);
      return response.data;
    } catch (error) {
      console.error('Błąd przy tworzeniu rezerwacji:', error);
      throw error;
    }
  },

  // NOWE - Pobierz moje rezerwacje
  getMyReservations: async () => {
    try {
      const response = await api.get('/reservations/my');
      return response.data.reservations;
    } catch (error) {
      console.error('Błąd przy pobieraniu rezerwacji:', error);
      throw error;
    }
  },

  // NOWE - Pobierz szczegóły rezerwacji
  getReservationById: async (id) => {
    try {
      const response = await api.get(`/reservations/${id}`);
      return response.data.reservation;
    } catch (error) {
      console.error('Błąd przy pobieraniu rezerwacji:', error);
      throw error;
    }
  },

  // NOWE - Anuluj rezerwację
  cancelReservation: async (id) => {
    try {
      const response = await api.patch(`/reservations/${id}/cancel`);
      return response.data;
    } catch (error) {
      console.error('Błąd przy anulowaniu rezerwacji:', error);
      throw error;
    }
  }
};

// NOWE - Funkcje API dla statystyk użytkownika
export const userAPI = {
  getStats: async () => {
    try {
      const response = await api.get('/users/stats');
      return response.data.stats;
    } catch (error) {
      console.error('Błąd przy pobieraniu statystyk:', error);
      throw error;
    }
  }
};

export default api;